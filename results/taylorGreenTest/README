First implement viscosity (and thermal conductivity)

----------------------- BEGIN LITERATURE SECTION -----------------------------------------------

literature research for implementing physical viscosity in SPH:
---------------------------------------------------------------

  REMARK: Liu2003 p.77: as now second kernel derivation comes into play: kernel function derivation
			needs to have compact support! (is the case for cubic spline)

			Added later: second kernel derivation not necessarily needed!
  
Liu2003 book describes 3 approaches to approximate physical viscosity (or more general physical diffusion (heat/momentum)
--------
	    
  1.)	"nested summation approach" (Flebbe1994 "Smoothed particle hydrodynamics - physical viscosity and
	 the simulation of accretion discs", astrophysical journal 431, 754-760, and others, see Liu2003 book)
	 equations are presented in Liu2003 p118-119 in a clearer way than in Flebbe1994!!
	  added later: expression also completely presented in BasaQuinlan2008 (see below)

	different formulation, that is also based on double summation:
	Watkins1996, Astronomy and Astrophysics Supplement, v.119, p.177-187
	"A new prescription for viscosity in smoothed particle hydrodynamics"
	
  2.)	approach of Monaghan1995 ("Heat conduction with discontinuous conductivity",
	applied mathematics report and reprint, monash university, article can not be found)
	equations can not be found either in ClearyMonaghan1999 
	(conduction modelling using smoothed particle hydrodynamics) which seems to be a continuation of Monaghan1995
	
	According to Liu2003, the same approach was also used by Morris1997 (Modeling low reynolds number
	INCOMPRESSIBLE flows using SPH) and the corresponding momentum equation including viscosity is
	given in Liu2003 p.129
	ATTENTION: BasaQuinlan2008 says, the Morris1997 model is based on a slightly different approach 
		   than the one of monaghan (while Morris also uses a mixed finite difference/SPH approach
		   to model the second derivative, his model is not based on the principal idea, which
		   has been used to conceive the Monaghan artificial viscosity)
	
	- this approach seems to be more appropriate for low velocity/low reynolds-number flows	

	(BasaQuinlan2008 (see below) states that the above formulation is only valid for incompressible flows)
	
	 
  3.) 	direct use of second derivative of smoothing function (Takeda1994, "numerical simulation of viscous flow
	by smootehd particle hydrodynamics")


  REMARK: Liu2003 suggests that one part of the artificial viscosity term might still be maintained, despite
	  of the implementation of physical viscosity (p.129). this can prevent unphysical particle penetration
          while removing spurious shear viscosity (as the other part of the art. viscosity term is removed)
 

Monaghan2005 Review paper cites 2 approaches (chapt.8) for implementation of physical viscosity:
------------
  
  1.) Cleary 1998 ("Modelling confined multi-material heat and mass flow using SPH") or
      ClearyAndHa2002 ("Flow modelling in casting processes")
	- use ideas similar to art. visvosity and heat conduction
	- applications to low reynolds-number flows (Morris 1997) and to systems with more than 1 fluid in contact
	
    => seems to be the same apporach as 2.) above (for Liu2003)
      (only strange how application can be done in 1997 if actual method only published in 1998, but probably
       Cleary not "original inventor" of this approach, but Monaghan and Cleary wokr to gether see also paper
	ClearyMonaghan1999)

  2.) approach of calculating velocity derivatives in viscous terms using SPH methods
      (Taketa1994, Watkins1996, Chaniotis2002, see ref. list in Monaghan2005)
	- conserves linear momentum, does not conserve angular momentum exactly
	- as conservation of angular momentum is not an issue for many applications,
	  good results (together with a re-meshing strategy, NOT OF INTEREST FOR US)
    
    => same approach as 3.) above (for Liu2003)

  besides: Monaghan2005 also mentiones natural viscosity in connection with the implementation 
	   of heat conduction (chapt. 7). This is due to the analogy of heat and momentum diffusion. 
	   He gives a way (based on ClearyMonaghan1999) to implement the heat conduction equatation based
	   on an integral approximation for the second derivative. 
	      This has several advantages over a direct use of 2nd derivative of smoothing function
	      (as suggested above (in Liu2003 3.) ))
	      as approximation using second kernel derivative (see 2.3, Monaghan2005) has following disadvantages:
		  + very sensitive to particle disorder
		  + heat transfer pos/neg depending on particle distance, as d²W/dx² can change sign
		    (not physical!!!)
		  + does not conserve thermal energy in adiabatic system

	    Furthermore, Monaghan gives an analog expression for matter diffusion,
	    but no explicit expression for momentum diffusion.


  BasaQuinlan2008 ("Robustness and accuracy of SPH formulations for viscous ﬂow")
-----------------

  In this paper, 5 different models of viscous stress terms are investigated, which at the same time 
  is a nice summary of the different techniques:
 
  1.) "direct derivatives model" (A) (second derivatives directly approximated by SPH)
	disadvantages (if no further corrections applied), see above!!!

  2.) two pass model (B) (see Flebbe1994) (corresponds to Liu2003 1.) )
      nesting of two first derivatives in order to obtain second derivatives
      i.e. one has to conduct 2 nested summations and information twice as much as "normal" has
      to be temporarily stored for each step, besides the boundary (which is made up of a cell of ghost particles)
      needs to be double as big (as due to the nested summation, if a is the original particle, and b its neighbors,	
      then even information on all particles c (c denoting neighboring particles of b) is needed!)

Models three four and five all use a combined ﬁnite-difference and 
SPH derivative to express second derivatives
AND according to BasaQuinlan2008, all 3 of these models implement a simplified viscous term
valid only for INCOMPRESSIBLE flow!!!!
(i.e if this is true, these 3 models are not appropriate for our purposes!!!)

   3.)  VioleauAndIssa2007 (C) ("Numerical modelling of complex turbulent free-surface ﬂows with the SPH method:
				an overview") 
	...expression for viscous term derived from the work of Monaghan

   4.) Cleary1998 (D) ("Modelling conﬁned multi-material heat and mass ﬂows using SPH")

	...different expression for viscous term also derived from the work of Monaghan!
	This is the form, Monaghan2005 talks about in chapt.7, because the expression is in perfect
	analogy with the equation for thermal conduction cited in this chapter (and originally derived
	by ClearyMonaghan1999, "Conduction Moedlling Using Smoothed Particle Hydrodynamics")

	disadvantage of this method: calibration factor , which is not universal!!!

	GOOD TO KNOW: the Cleary1998 paper gives some general rules on how to set up boundary particles
		      if the boundary is not shaped in a way the boundary particles allign with the particle lattice.
		      This is only meant to be for a solid, but perhaps some of the advice might also be useful
		      if I have to create different boundary shapes for coming simulations!

		      also for boundaries: Computer Physics Communications
				    Volume 180, Issue 10, October 2009, Pages 1811-1820 
				  "SPH term particle boundary forces for arbitrary boundaries"

   5.) Morris1997 (E)
      ...this model is based on a different approaches	
      conserves limear momentum exactly but angular momentum only approximately (which according to Morris does not
      matter that much for low Reynolds flows) as viscous
      force alligned to relative velocity vector rather to distance vector (as it is the case for artVis and
      the models C,D, which therefore also conserve angular momentum exactly)
      In original paper, aplication only for incompressible low reynoldsnumber flows, and therefore viscosity
      not taken into account in the energy equation

      GOOD TO KNOW: Morris1997 gives a detailed description of hot to implement boundary particles. He also
		    mentiones references for curved boundaries (where the simple "copying" does not work) and for 
                    modeling objects in the flow (by imobilizing boundary particles)

--INDEED: all reported applications of the last 3 models are limited to the incompressible case!!!
    That is a pitty, because 
      a) it would have been logical to implement the (physical) viscous diffusion in the same way
	 as the thermal diffusion (i.e. use model (D) )
      b) models D,E are the best ones for the 2 test cases poiseuille flow and lid driven cavity

      WAHT I DO NOT UNDERSTAND: they say, models C,D,E are based on a simplified viscous stress model for
      incompressible flow, BUT they use themselves a compressible flow version for the test cases???
      
      Does this mean, the underlying incompressible stress model is just a model assumption, but the actual
      expression is valid for compressible flows as well? I am still sceptical because I have not found
      any original applications ( I mean e.g. by the original authorsof the corresponding methods)
      of these models to compresisble flow???


PICK A VISCOSITY MODEL FOR IMPLEMENTATION:


Model A: not robust enough (high sensitivity to particle disorder ...) --> not appropriate for implementation
	 ..would need corrections to become robust:(re-meshing, i.e. particles periodically reordered..,
	 and variable h, to keep neighborus ~const. (but the latter is not a big deal)
	  for compressible viscous flows with heat conductuion, see: 
	  Chaniotis2002 Journal of Computational Physics 182, 67–90 (2002)
	  "Remeshed Smoothed Particle Hydrodynamics for the Simulation of Viscous and Heat Conducting Flows"



Model B: not the best results in tests of BasaQuinlan2008, but should be valid for compressible flows
         Problem: more complicated to implement because boundary particles would haveto be doubled
                 and interaction calculation performed once more for each time step and particle.
	--> not the best choice either

Model C,D,E : allegedly based on assumptions for the incompressible stress tensor (and mue=spatially constant),
              there are doubts if these cases are suitable for our purposes. However, BasaQuinlan2008 test
              these models for acompressible flow as well??? (how does that go together???)

	      for the  BasaQuinlan2008 test cases D, E gave the best results, therefore implementation of one
              of them:
              D: advantage: same principle as monaghan heat conduction (equation is in perfect analogie)
                 disadvantage: there is a calibration factor, about which there are doubts (probably non-universal)
	      E: no calibration factor needed, with good results (for low velocities/reynoldsnumbers)
		 disadvantage: does not conserve angularmomentum exactly (which gets only a problem for higher velocities)

Implemented model will be: Espagnol2003.

-assumes that no big spacial variations in the viscosities (shear bulk) occurr 
(which is probably not exactly right for the case of final application because
of wall cooling and temperature dependence of viscosity)
-continuous formutaltion of momentu equation for non constant viscosities in espagnols ref.19 (p.310),
 equivalent discrete formulation can be derived.
-model implements shear and bulk viscosity, bulk viscosity initially set to zero (though implemented)
 (which is justified for a diluted gas (according to espagnols ref. 19(p.310)
 (both viscosities are given in .tcl file as material properties, values for bulk viscosities hardly known,
 see JOURNAL OF THERMOPHYSICS AND HEAT TRANSFER Vol. 13, No. 3, 1999 "Bulk Viscosity: Past to Present")
 one can take zeta = -2/3 eta, as hypothesized by stokes (see anderson fundamentals of aerodynamics,eq 15.11))

-for the later step of a variable viscosity (as viscosity =f(T) and T in general variable), there are several
possibilities (some seem more correct than others)
1. adapting the formulation of hu/adams which wasderived for DISCONTINUOUS viscosity (e.g two different phases)
 this results in a formulaton of an effective viscosity in analogy with cleary1999 for the thermal conduction 
(both postulated that viscous stress or heat flux respectivelyshould be the same at interface for both sides)
=> I think this is not an appropriate approach as it does not take into account the spatial evolution of viscosity
  but is based on a NSG formulation with viscosity=cte.

2. just averaging the viscosities of 2 particles (still taking the viscosity fromulation derived for constant visc.)

3. deriving a SPH formulation for variable viscosity based on espagnols2003 const. viscosity approach.
=> would be most accurate, but also most complex.


- the units of the viscosities used in the equations are: 
   [Pa s]-> dynamic viscosity












	  
